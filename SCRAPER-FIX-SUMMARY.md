# ğŸ”§ é‡‡é›†ä¸­å¿ƒä¿®å¤æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ç½‘ç»œè¿é€šæ€§æµ‹è¯•
- âœ… åˆ›å»ºäº†æµ‹è¯•è„šæœ¬ `scripts/test-polymarket-api.ts`
- âœ… æµ‹è¯•ç»“æœï¼šAPI è¿é€šæ€§æ­£å¸¸ï¼Œå¯ä»¥æˆåŠŸè®¿é—® Polymarket API
- âœ… å“åº”æ—¶é—´ï¼š~1.2ç§’

### 2. è¯¦ç»†é”™è¯¯æ—¥å¿—
å·²åœ¨ä»¥ä¸‹ä½ç½®å¢åŠ è¯¦ç»†æ—¥å¿—ï¼š

#### `lib/scrapers/polymarketAdapter.ts`
- âœ… æ·»åŠ äº†å®Œæ•´çš„é”™è¯¯æ•è·å’Œæ—¥å¿—è¾“å‡º
- âœ… è®°å½•é”™è¯¯ç±»å‹ã€é”™è¯¯æ¶ˆæ¯ã€é”™è¯¯å †æ ˆ
- âœ… è®°å½•è¯·æ±‚ URLã€æ—¶é—´æˆ³ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯
- âœ… è®°å½• API å“åº”çŠ¶æ€å’Œå“åº”å¤´

#### `lib/scrapers/engine.ts`
- âœ… å¢å¼ºäº† execute() æ–¹æ³•çš„æ—¥å¿—è¾“å‡º
- âœ… éªŒè¯é‡‡é›†æºè®°å½•å­˜åœ¨æ€§
- âœ… è¯¦ç»†è®°å½•æ¯ä¸ªæ­¥éª¤çš„æ‰§è¡Œæƒ…å†µ
- âœ… å®Œæ•´çš„é”™è¯¯å¯¹è±¡è¾“å‡ºåˆ°æ§åˆ¶å°

#### `app/api/admin/scrapers/[sourceName]/run/route.ts`
- âœ… æ·»åŠ äº†è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—
- âœ… è®°å½•é‡‡é›†æºåç§°ã€è¯·æ±‚æ—¶é—´
- âœ… å®Œæ•´çš„é”™è¯¯æ•è·å’Œæ—¥å¿—è¾“å‡º

### 3. é‡‡é›†æº ID åŒ¹é…éªŒè¯
- âœ… åˆ›å»ºäº†éªŒè¯è„šæœ¬ `scripts/verify-source-name.ts`
- âœ… PolymarketAdapter ä½¿ç”¨çš„ sourceName: `"Polymarket"`
- âœ… æ•°æ®åº“ä¸­å­˜å‚¨çš„ sourceName: `"Polymarket"`
- âœ… ä¸¤è€…å®Œå…¨åŒ¹é…

### 4. æƒé™éªŒè¯æ£€æŸ¥
- âœ… æ£€æŸ¥äº† `/api/admin/scrapers/[sourceName]/run/route.ts`
- âœ… **è¯¥è·¯ç”±æ²¡æœ‰æƒé™éªŒè¯ä»£ç **ï¼Œä¸å­˜åœ¨ getServerSession æƒé™æ ¡éªŒ
- âœ… æ— éœ€ç»•è¿‡æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®

---

## ğŸ” é—®é¢˜æ’æŸ¥ç»“æœ

### å¯èƒ½çš„åŸå› 

1. **Next.js æœåŠ¡å™¨ç«¯ fetch é—®é¢˜**
   - åœ¨ Next.js 13+ çš„æœåŠ¡å™¨ç«¯ï¼Œfetch å¯èƒ½æœ‰ä¸€äº›é™åˆ¶
   - å·²ç§»é™¤ `next: { revalidate: 60 }` é€‰é¡¹ï¼ˆåœ¨ fetch ä¸­è¿™ä¸ªé€‰é¡¹å¯èƒ½å¯¼è‡´é—®é¢˜ï¼‰

2. **ä»£ç†é…ç½®**
   - ä»£ç ä¸­å·²æ·»åŠ ä»£ç†æ”¯æŒæ£€æŸ¥
   - å¦‚æœåœ¨ä¸­å›½å¤§é™†ç¯å¢ƒï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
     ```bash
     export HTTPS_PROXY=http://localhost:7890
     ```
     æˆ–åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ï¼š
     ```
     PROXY_URL=http://localhost:7890
     ```

3. **DNS æˆ–ç½‘ç»œé—®é¢˜**
   - è™½ç„¶æµ‹è¯•è„šæœ¬èƒ½è®¿é—®ï¼Œä½† Next.js è¿è¡Œæ—¶ç¯å¢ƒå¯èƒ½ä¸åŒ
   - ç°åœ¨ä¼šæœ‰è¯¦ç»†çš„é”™è¯¯æ—¥å¿—æ¥è¯Šæ–­å…·ä½“é—®é¢˜

---

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
é‡æ–°è¿è¡Œé‡‡é›†ï¼ŒæŸ¥çœ‹æœåŠ¡å™¨ç»ˆç«¯è¾“å‡ºçš„è¯¦ç»†æ—¥å¿—ï¼š

```
ğŸ“¡ [PolymarketAdapter] å¼€å§‹è¯·æ±‚ API: ...
ğŸ”„ [PolymarketAdapter] å‘é€è¯·æ±‚...
ğŸ“¥ [PolymarketAdapter] å“åº”çŠ¶æ€: ...
âŒ [PolymarketAdapter] fetch å¤±è´¥è¯¦æƒ…: {
  errorType: ...,
  errorMessage: ...,
  errorStack: ...,
  url: ...,
  timestamp: ...
}
```

### 2. å¦‚æœä»ç„¶å¤±è´¥

æ ¹æ®é”™è¯¯æ—¥å¿—ä¸­çš„ `errorType` å’Œ `errorMessage` æ¥åˆ¤æ–­ï¼š

- **TypeError: fetch failed**
  - å¯èƒ½æ˜¯ DNS è§£æå¤±è´¥
  - å¯èƒ½æ˜¯ç½‘ç»œè¿æ¥é—®é¢˜
  - å°è¯•è®¾ç½®ä»£ç†ï¼ˆå¦‚æœæ˜¯ä¸­å›½å¤§é™†ç¯å¢ƒï¼‰

- **403 Forbidden**
  - API å¯èƒ½æ£€æµ‹åˆ°çˆ¬è™«
  - å¯èƒ½éœ€è¦æ·»åŠ æ›´å¤šè¯·æ±‚å¤´

- **ECONNREFUSED**
  - è¿æ¥è¢«æ‹’ç»
  - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 3. æµ‹è¯•è„šæœ¬

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ API è¿é€šæ€§ï¼š
```bash
npx tsx scripts/test-polymarket-api.ts
```

è¿è¡ŒéªŒè¯è„šæœ¬æ£€æŸ¥ sourceName åŒ¹é…ï¼š
```bash
npx tsx scripts/verify-source-name.ts
```

---

## ğŸ”§ ä»£ç ä¿®æ”¹æ¸…å•

1. âœ… `lib/scrapers/polymarketAdapter.ts` - å¢å¼ºé”™è¯¯æ—¥å¿—
2. âœ… `lib/scrapers/engine.ts` - å¢å¼ºæ‰§è¡Œæ—¥å¿—
3. âœ… `app/api/admin/scrapers/[sourceName]/run/route.ts` - å¢å¼ºé”™è¯¯å¤„ç†
4. âœ… `scripts/test-polymarket-api.ts` - æ–°å»º API æµ‹è¯•è„šæœ¬
5. âœ… `scripts/verify-source-name.ts` - æ–°å»ºæºåç§°éªŒè¯è„šæœ¬

---

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œå½“é‡‡é›†å¤±è´¥æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¯¦ç»†æ—¥å¿—ï¼š

```
âŒ [PolymarketAdapter] fetch å¤±è´¥è¯¦æƒ…: {
  errorType: 'TypeError',
  errorMessage: 'fetch failed',
  errorStack: '...',
  url: 'https://gamma-api.polymarket.com/markets?...',
  timestamp: '2025-12-19T...'
}
```

è¿™å°†å¸®åŠ©æˆ‘ä»¬å‡†ç¡®å®šä½é—®é¢˜æ‰€åœ¨ã€‚
