# 测试环境验证清单

**验证日期**: 2025-01-30  
**验证环境**: 测试环境

---

## 📋 验证清单

### 1. 环境变量配置 ✅

#### 必需的环境变量

- [ ] **DATABASE_URL**
  - **用途**: PostgreSQL 数据库连接字符串
  - **格式**: `postgresql://user:password@host:port/database?schema=public`
  - **验证**: 连接字符串格式正确，数据库可访问

- [ ] **NEXTAUTH_URL**
  - **用途**: NextAuth.js 基础 URL
  - **测试环境**: `http://localhost:3000` 或测试环境 URL
  - **验证**: URL 格式正确

- [ ] **NEXTAUTH_SECRET**
  - **用途**: NextAuth.js 加密密钥
  - **验证**: 已设置且长度足够（建议 32+ 字符）

- [ ] **NODE_ENV**
  - **用途**: 运行环境标识
  - **测试环境**: `development` 或 `test`
  - **验证**: 已正确设置

#### 可选的环境变量

- [ ] **NEXT_PUBLIC_API_URL**
  - **用途**: 前端 API 基础 URL
  - **默认**: 使用相对路径（`/api`）

- [ ] **NEXT_PUBLIC_APP_URL**
  - **用途**: 应用基础 URL（用于生成链接）
  - **测试环境**: `http://localhost:3000`

- [ ] **GOOGLE_CLIENT_ID** (如果使用 Google OAuth)
  - **用途**: Google OAuth 客户端 ID

- [ ] **GOOGLE_CLIENT_SECRET** (如果使用 Google OAuth)
  - **用途**: Google OAuth 客户端密钥

- [ ] **TRANSLATE_API_KEY** (如果使用翻译服务)
  - **用途**: 翻译 API 密钥

---

### 2. 数据库配置 ✅

#### 数据库连接

- [ ] **数据库服务运行**
  - **验证**: PostgreSQL 服务正在运行
  - **命令**: `docker ps` 或 `psql -U postgres -c "SELECT version();"`

- [ ] **数据库存在**
  - **验证**: 目标数据库已创建
  - **命令**: `psql -U postgres -l | grep yesno_db`

- [ ] **数据库迁移**
  - **验证**: 所有迁移已应用
  - **命令**: `npx prisma migrate status`
  - **预期**: 所有迁移显示为 `Applied`

- [ ] **Prisma Client 生成**
  - **验证**: Prisma Client 已生成
  - **命令**: `npx prisma generate`
  - **预期**: 无错误

#### 数据库数据

- [ ] **系统账户存在**
  - **验证**: 系统账户（手续费账户、AMM 账户等）已创建
  - **查询**: 
    ```sql
    SELECT email FROM users WHERE email LIKE 'system.%';
    ```

- [ ] **管理员账户存在**
  - **验证**: 至少有一个管理员账户
  - **查询**: 
    ```sql
    SELECT email, "isAdmin" FROM users WHERE "isAdmin" = true;
    ```

---

### 3. 应用构建 ✅

#### 构建检查

- [ ] **依赖安装**
  - **验证**: `node_modules` 存在且完整
  - **命令**: `npm install`
  - **预期**: 无错误

- [ ] **TypeScript 编译**
  - **验证**: TypeScript 代码可编译
  - **命令**: `npx tsc --noEmit --skipLibCheck`
  - **预期**: 无阻塞性错误（类型定义问题可忽略）

- [ ] **生产构建**
  - **验证**: 可以成功构建生产版本
  - **命令**: `npm run build`
  - **预期**: 构建成功，无错误

- [ ] **ESLint 检查**
  - **验证**: 代码质量检查通过
  - **命令**: `npm run lint`
  - **预期**: 无严重错误

---

### 4. 功能验证 ✅

#### 核心功能

- [ ] **应用启动**
  - **验证**: 应用可以正常启动
  - **命令**: `npm run dev` 或 `npm start`
  - **预期**: 服务器启动，无错误

- [ ] **首页加载**
  - **验证**: 首页可以正常访问
  - **URL**: `http://localhost:3000`
  - **预期**: 页面正常渲染，无错误

- [ ] **API 路由**
  - **验证**: API 路由可以正常访问
  - **测试**: 
    - `GET /api/markets` - 市场列表
    - `GET /api/auth/me` - 用户信息
  - **预期**: 返回正确的 JSON 响应

- [ ] **数据库查询**
  - **验证**: 数据库查询正常工作
  - **测试**: 访问需要数据库的页面
  - **预期**: 数据正常显示

---

### 5. 安全性验证 ✅

#### 认证与授权

- [ ] **管理员认证**
  - **验证**: 管理员登录正常工作
  - **测试**: 访问 `/admin/login`，使用管理员账号登录
  - **预期**: 登录成功，跳转到 `/admin/dashboard`

- [ ] **权限验证**
  - **验证**: 非管理员无法访问管理 API
  - **测试**: 未登录状态下访问 `/api/admin/markets/review`
  - **预期**: 返回 401 Unauthorized

- [ ] **Cookie 传输**
  - **验证**: Token 通过 HttpOnly Cookie 传输
  - **测试**: 使用浏览器 DevTools 检查请求头
  - **预期**: 请求包含 Cookie，无硬编码 Token

---

### 6. 数据完整性 ✅

#### 数据验证

- [ ] **数据清洗后验证**
  - **验证**: 数据清洗后系统正常运行
  - **测试**: 访问各个页面，验证数据正常显示
  - **预期**: 无数据错误，页面正常渲染

- [ ] **数据隔离**
  - **验证**: 用户数据隔离正常工作
  - **测试**: 使用不同用户登录，验证只能看到自己的数据
  - **预期**: 数据隔离正确

---

## 📊 验证结果记录

### 验证日期
**日期**: _______________

### 验证人员
**人员**: _______________

### 验证结果

| 检查项 | 状态 | 备注 |
|--------|------|------|
| 环境变量配置 | ⏳ | |
| 数据库配置 | ⏳ | |
| 应用构建 | ⏳ | |
| 功能验证 | ⏳ | |
| 安全性验证 | ⏳ | |
| 数据完整性 | ⏳ | |

### 发现的问题

1. 
2. 
3. 

---

## ✅ 验证通过标准

所有检查项必须满足以下条件：

1. ✅ **环境变量**: 所有必需的环境变量已配置
2. ✅ **数据库**: 数据库连接正常，迁移已应用
3. ✅ **构建**: 生产构建成功，无阻塞性错误
4. ✅ **功能**: 核心功能正常工作
5. ✅ **安全**: 认证和权限验证正常工作
6. ✅ **数据**: 数据完整性良好，数据隔离正确

---

**验证完成后，请填写验证结果并记录发现的问题。**

