# CONTEXT.md 使用指南

## 📖 如何在新的 Agent 会话中使用 CONTEXT.md

### 方法一：直接引用文件（推荐）

在新的 agent 会话开始时，直接告诉 agent：

```
请先阅读 CONTEXT.md 文档，了解项目上下文
```

或者更详细的指令：

```
请先阅读并理解项目根目录下的 CONTEXT.md 文档，这个文档包含了：
1. 项目架构和技术栈
2. 数据库模型和字段说明
3. 认证系统（双认证系统）
4. 关键修复和代码约定
5. 赔率监控中心功能
6. 数据流和脚本说明
7. 常见问题排查方法

阅读完成后，请确认你已经理解了项目的核心架构和约定。
```

### 方法二：使用 @ 符号引用

在 Cursor 中，你可以使用 `@CONTEXT.md` 来引用文档：

```
@CONTEXT.md 请根据这个文档中的信息，帮我修复市场列表显示问题
```

### 方法三：在对话中提供关键信息

如果 agent 没有自动读取，你可以手动提供关键信息：

```
项目使用 Next.js 14 + TypeScript + Prisma + PostgreSQL
关键约定：
1. 严禁使用 Prisma upsert，必须用 findUnique + update/create
2. 所有 API 路由必须添加 export const dynamic = 'force-dynamic'
3. 市场创建时必须设置 reviewStatus: 'PUBLISHED'
4. 分类 ID 必须是 UUID 格式
5. 赔率显示优先级：outcomePrices > initialPrice > 本地计算 > 50/50

详细说明请查看 CONTEXT.md
```

## 🎯 使用场景示例

### 场景 1：修复 Bug

```
用户：市场列表显示 50/50 赔率，应该显示真实赔率

Agent 应该：
1. 先读取 CONTEXT.md，了解赔率显示逻辑
2. 查看 "赔率显示逻辑" 章节
3. 检查 MarketCard.tsx 是否正确实现了优先级
4. 检查 API 是否返回了 outcomePrices 字段
```

### 场景 2：添加新功能

```
用户：添加一个新的市场筛选功能

Agent 应该：
1. 先读取 CONTEXT.md，了解市场查询约定
2. 查看 "市场查询约定" 章节
3. 了解过滤条件：isActive: true, reviewStatus: 'PUBLISHED'
4. 参考现有的 API 路由实现
```

### 场景 3：数据库操作

```
用户：需要更新市场的赔率数据

Agent 应该：
1. 先读取 CONTEXT.md，了解 Prisma 操作约定
2. 查看 "Prisma 操作约定" 章节
3. 使用 findUnique + update/create，不要用 upsert
4. 了解 Market 模型的字段结构
```

## 📋 CONTEXT.md 文档结构

文档包含以下主要章节：

1. **项目概述** - 技术栈和基本介绍
2. **数据库架构** - 所有模型和字段说明
3. **认证系统** - 双认证系统说明
4. **关键修复和约定** - 代码约定和最佳实践
5. **赔率监控中心** - 新功能说明
6. **数据流和脚本** - 各种脚本和自动化任务
7. **重要工具函数** - DBService 等工具
8. **已知问题和注意事项** - 待修复的问题
9. **关键文件位置** - 重要文件路径
10. **数据流示例** - 流程图和示例
11. **调试和排查** - 常见问题解决方法
12. **代码约定** - 编码规范
13. **实际使用示例** - 代码示例
14. **当前项目状态** - 已完成和待实现的功能

## ⚠️ 重要提示

1. **每次开始新任务前，都应该先读取 CONTEXT.md**
2. **修改数据库相关代码时，必须参考数据库架构章节**
3. **添加新 API 时，必须遵循 API 缓存控制约定**
4. **创建市场时，必须遵循市场创建流程**
5. **遇到问题时，先查看"调试和排查"章节**

## 🔄 文档更新

当项目有重大变更时，应该及时更新 CONTEXT.md：

- 添加新功能时，更新相应章节
- 修复重要 Bug 时，更新"关键修复和约定"
- 数据库结构变更时，更新"数据库架构"
- 新增脚本时，更新"数据流和脚本"

## 💡 最佳实践

1. **在开始任何任务前，先让 agent 读取 CONTEXT.md**
2. **如果 agent 没有自动读取，明确要求它读取**
3. **对于复杂任务，可以要求 agent 先总结理解的内容**
4. **修改代码后，如果发现与文档不符，应该更新文档**

---

**提示**: 这个文档是项目的"知识库"，确保 agent 在开始工作前充分理解项目上下文，可以大大提高工作效率和代码质量。
