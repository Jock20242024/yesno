# 代码清理计划

**制定时间**: 2025-01-30  
**目标**: 清理未使用代码、注释、临时文件，提高代码质量

---

## 🔍 需要清理的内容

### 1. 未使用的导入

**识别方法**:
- 使用 ESLint 的 `no-unused-vars` 规则
- 使用 TypeScript 编译检查（会报告未使用的导入）

**清理策略**:
- 删除未使用的导入
- 保持导入的组织性（按字母顺序或类型分组）

---

### 2. 未使用的变量和函数

**识别方法**:
- TypeScript 编译检查
- ESLint 检查

**清理策略**:
- 删除未使用的变量和函数
- 如果将来可能使用，添加 `// TODO: 将来可能使用` 注释

---

### 3. 调试代码和注释

**识别方法**:
- 搜索 `console.log`（已清理，但需要确认）
- 搜索 `debugger` 语句
- 搜索 `// TODO:` 和 `// FIXME:` 注释（评估是否需要保留）

**清理策略**:
- 删除 `console.log`（保留 `console.error` 和 `console.warn`）
- 删除 `debugger` 语句
- 评估 `TODO` 和 `FIXME` 注释，决定是否保留

---

### 4. 临时文件和测试文件

**识别方法**:
- 检查 `scripts/` 目录中的临时脚本
- 检查根目录中的临时文件
- 检查 `.tmp`、`.bak` 等临时文件

**清理策略**:
- 删除临时文件
- 如果脚本有用，移动到合适的位置或文档化

---

### 5. 硬编码的测试数据

**识别方法**:
- 搜索硬编码的测试数据（如测试用户ID、测试市场ID等）
- 搜索 `test@test.com`、`123456` 等测试数据

**清理策略**:
- 移除硬编码的测试数据
- 使用环境变量或配置文件

---

### 6. 重复代码

**识别方法**:
- 代码审查
- 使用工具检测代码重复

**清理策略**:
- 提取公共函数
- 使用工具函数库

---

### 7. 注释掉的代码

**识别方法**:
- 搜索大段注释掉的代码块

**清理策略**:
- 删除注释掉的代码（如果不再需要）
- 如果代码有用，取消注释并修复

---

## 📋 清理检查清单

### TypeScript 和代码质量

- [ ] 运行 `npx tsc --noEmit` 检查类型错误（应该已经完成）
- [ ] 运行 `npm run lint` 检查代码规范
- [ ] 修复所有 ESLint 警告和错误
- [ ] 检查未使用的导入
- [ ] 检查未使用的变量和函数

### 调试代码

- [ ] 搜索并删除所有 `console.log`（应该已经完成，但需要确认）
- [ ] 搜索并删除所有 `debugger` 语句
- [ ] 搜索并删除所有 `alert()` 调用（在生产代码中）

### 注释和文档

- [ ] 评估所有 `// TODO:` 注释，决定是否保留
- [ ] 评估所有 `// FIXME:` 注释，决定是否修复
- [ ] 删除过时的注释
- [ ] 确保关键函数有 JSDoc 注释

### 文件和目录

- [ ] 检查并删除临时文件（`.tmp`、`.bak` 等）
- [ ] 检查并删除未使用的测试文件
- [ ] 检查 `scripts/` 目录，删除或文档化临时脚本
- [ ] 检查根目录，删除临时文件

### 硬编码数据

- [ ] 搜索硬编码的测试数据
- [ ] 搜索硬编码的配置值（应该使用环境变量）
- [ ] 搜索硬编码的 URL（应该使用配置文件）

---

## 🔧 清理脚本示例

### 脚本 1: 检查未使用的导入

```bash
# 使用 ESLint 检查未使用的导入
npm run lint -- --fix

# 或者使用 TypeScript
npx tsc --noEmit
```

### 脚本 2: 搜索调试代码

```bash
# 搜索 console.log（应该已经清理）
grep -r "console.log" app/ components/ lib/ --exclude-dir=node_modules

# 搜索 debugger
grep -r "debugger" app/ components/ lib/ --exclude-dir=node_modules

# 搜索 alert
grep -r "alert(" app/ components/ --exclude-dir=node_modules
```

### 脚本 3: 搜索硬编码测试数据

```bash
# 搜索测试邮箱
grep -r "test@test.com\|admin@admin.com" app/ components/ lib/ --exclude-dir=node_modules

# 搜索硬编码的测试 ID
grep -r "test-user-id\|test-market-id" app/ components/ lib/ --exclude-dir=node_modules
```

---

## 📊 清理前后对比

### 代码质量指标

**清理前**:
- TypeScript 错误: ____
- ESLint 警告: ____
- 未使用的导入: ____
- console.log 数量: ____（应该已经是 0）
- 硬编码测试数据: ____

**清理后**:
- TypeScript 错误: 0
- ESLint 警告: 0
- 未使用的导入: 0
- console.log 数量: 0
- 硬编码测试数据: 0

---

## ✅ 清理执行步骤

### 步骤 1: 代码质量检查

```bash
# 1. TypeScript 类型检查
npx tsc --noEmit

# 2. ESLint 检查
npm run lint

# 3. 记录发现的问题
```

### 步骤 2: 自动修复

```bash
# 使用 ESLint 自动修复
npm run lint -- --fix
```

### 步骤 3: 手动清理

1. 删除未使用的导入和变量
2. 删除调试代码
3. 删除临时文件
4. 移除硬编码的测试数据

### 步骤 4: 验证

```bash
# 再次运行检查，确保所有问题已解决
npx tsc --noEmit
npm run lint

# 运行测试（如果有）
npm test
```

---

## ⚠️ 注意事项

1. **版本控制**: 确保所有更改都提交到版本控制
2. **测试验证**: 清理后运行测试，确保功能正常
3. **渐进式清理**: 不要一次性清理太多，分批次进行
4. **保留必要注释**: 保留重要的业务逻辑注释和文档

---

## 📝 清理记录

**清理日期**: _______________  
**清理人员**: _______________  

**清理内容**:
- [ ] 未使用的导入
- [ ] 未使用的变量和函数
- [ ] 调试代码（console.log, debugger）
- [ ] 临时文件
- [ ] 硬编码测试数据
- [ ] 注释掉的代码

**清理统计**:
- 删除的文件数: ____
- 删除的代码行数: ____
- 修复的 ESLint 警告: ____

---

**建议**: 代码清理应该在数据清洗之前完成，确保数据清洗脚本基于稳定的代码库。

