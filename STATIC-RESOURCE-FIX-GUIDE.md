# âš¡ ä¸“é¡¹ä»»åŠ¡ï¼šå½»åº•æ ¹é™¤é™æ€èµ„æº 400 æŠ¥é”™

**ç›®æ ‡**ï¼šè®© `_next/static` ä¸‹çš„ JS æ–‡ä»¶æ¢å¤ 200 å“åº”

---

## âœ… å·²å®Œæˆçš„æ­¥éª¤

### 1. ç¯å¢ƒå˜é‡ç»ˆæå¯¹é½ âœ…

**æ£€æŸ¥ç»“æœ**ï¼š
- âœ… `.env.production` ä¸­çš„ `NEXTAUTH_URL=http://localhost:3000`
- âœ… æ— å°¾éšç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦
- âœ… æ ¼å¼æ­£ç¡®

### 2. æ¸…ç†æ‰€æœ‰ç¼“å­˜ âœ…

**å·²æ‰§è¡Œ**ï¼š
- âœ… åˆ é™¤ `.next` ç›®å½•
- âœ… åˆ é™¤ `node_modules/.cache`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- âœ… æ£€æŸ¥å…¶ä»–ç¼“å­˜ç›®å½•

### 3. é‡æ–°æ„å»º âœ…

**å·²æ‰§è¡Œ**ï¼š
- âœ… `npm run build` - æ„å»ºæˆåŠŸ
- âœ… Middleware å¤§å°ï¼š19.2 kBï¼ˆå·²ç¦ç”¨ï¼‰
- âœ… é™æ€æ–‡ä»¶å·²ç”Ÿæˆ

**æ‰¾åˆ°çš„é™æ€æ–‡ä»¶ç¤ºä¾‹**ï¼š
- `.next/static/chunks/2117-7a930db66043ac4e.js`
- `.next/static/chunks/main-app-d615427325c7bfeb.js`
- `.next/static/chunks/6521-230548c75fee4358.js`

---

## ğŸ” æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: å¯åŠ¨æœåŠ¡å™¨

```bash
npm start
```

### æ­¥éª¤ 2: æµ‹è¯•é™æ€èµ„æºè®¿é—®

**æ–¹æ³• A: ä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
./test-static-resource.sh
```

**æ–¹æ³• B: æ‰‹åŠ¨ curl æµ‹è¯•**

```bash
# æµ‹è¯•ä¸€ä¸ªå®é™…çš„é™æ€æ–‡ä»¶
curl -I "http://localhost:3000/_next/static/chunks/2117-7a930db66043ac4e.js"
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… **å¦‚æœè¿”å› 200 OK** â†’ é—®é¢˜å·²è§£å†³
- âŒ **å¦‚æœè¿”å› 400 Bad Request** â†’ éœ€è¦æŸ¥çœ‹å“åº”å¤´åˆ†æ

### æ­¥éª¤ 3: åˆ†æ 400 é”™è¯¯ï¼ˆå¦‚æœä»ç„¶å­˜åœ¨ï¼‰

**æŸ¥çœ‹å“åº”å¤´**ï¼š
```bash
curl -v "http://localhost:3000/_next/static/chunks/2117-7a930db66043ac4e.js" 2>&1 | grep -E "< HTTP|Server:|Content-Type:"
```

**å…³é”®ä¿¡æ¯**ï¼š
- `Server:` å¤´ - å‘Šè¯‰æˆ‘ä»¬æ˜¯å“ªä¸ªç»„ä»¶æ‹’ç»äº†è¯·æ±‚
- `Content-Type:` å¤´ - å‘Šè¯‰æˆ‘ä»¬è¿”å›çš„å†…å®¹ç±»å‹
- å“åº”ä½“ - å¦‚æœæ˜¯ HTMLï¼Œè¯´æ˜æ˜¯é‡å®šå‘é¡µé¢

---

## ğŸ¯ è¯Šæ–­é€»è¾‘

### åœºæ™¯ A: Middleware å·²ç¦ç”¨ï¼Œä½†ä»æœ‰ 400 é”™è¯¯

**å¯èƒ½åŸå› **ï¼š
1. Next.js å†…éƒ¨è·¯ç”±ç³»ç»Ÿé—®é¢˜
2. è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®
3. åå‘ä»£ç†æˆ– CDN é…ç½®
4. æµè§ˆå™¨ç¼“å­˜ï¼ˆéœ€è¦ç¡¬åˆ·æ–°ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨ï¼ˆ`server.js`ï¼‰
- æ£€æŸ¥æ˜¯å¦æœ‰åå‘ä»£ç†é…ç½®
- ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶ç¡¬åˆ·æ–°

### åœºæ™¯ B: Middleware å·²ç¦ç”¨ï¼Œ400 é”™è¯¯æ¶ˆå¤±

**ç»“è®º**ï¼šé—®é¢˜ç¡®å®åœ¨ Middleware

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ `middleware.ts.NATIVE-COOKIE-CHECK.ts`ï¼ˆåŸç”Ÿ Cookie æ£€æŸ¥ï¼‰
2. æˆ–è€…è¿›ä¸€æ­¥ä¼˜åŒ– Middleware çš„é™æ€èµ„æºæ”¾è¡Œé€»è¾‘

### åœºæ™¯ C: è¿”å› 400ï¼Œä½†å“åº”ä½“æ˜¯ HTML

**åˆ†æ**ï¼š
- å¦‚æœæ˜¯ `/admin/login` é¡µé¢çš„ HTML â†’ è¯´æ˜æ˜¯é‡å®šå‘é€»è¾‘é—®é¢˜
- å¦‚æœæ˜¯é”™è¯¯é¡µé¢çš„ HTML â†’ è¯´æ˜æ˜¯æœåŠ¡å™¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ Middleware çš„é‡å®šå‘é€»è¾‘
- æ£€æŸ¥ Next.js è·¯ç”±é…ç½®

---

## ğŸ“‹ å½“å‰çŠ¶æ€

**Middleware çŠ¶æ€**ï¼š
- âœ… å·²å®Œå…¨ç¦ç”¨ï¼ˆç©ºå‡½æ•°ï¼Œç©º matcherï¼‰
- âœ… ä¸ä¼šæ‹¦æˆªä»»ä½•è¯·æ±‚

**æ„å»ºçŠ¶æ€**ï¼š
- âœ… å·²é‡æ–°æ„å»º
- âœ… é™æ€æ–‡ä»¶å·²ç”Ÿæˆ

**ä¸‹ä¸€æ­¥**ï¼š
1. å¯åŠ¨æœåŠ¡å™¨ï¼š`npm start`
2. æ‰§è¡Œæµ‹è¯•ï¼š`./test-static-resource.sh`
3. æ ¹æ®æµ‹è¯•ç»“æœå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨

---

## ğŸ› ï¸ å¦‚æœæµ‹è¯•åä»æœ‰ 400 é”™è¯¯

### æ£€æŸ¥æ¸…å•

1. **æµè§ˆå™¨ç¼“å­˜**ï¼š
   - ä½¿ç”¨æ— ç—•æ¨¡å¼
   - æ¸…é™¤ç¼“å­˜å¹¶ç¡¬åˆ·æ–°ï¼ˆCmd+Shift+Rï¼‰

2. **æœåŠ¡å™¨æ—¥å¿—**ï¼š
   - æŸ¥çœ‹ç»ˆç«¯è¾“å‡º
   - æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯

3. **å“åº”ä½“åˆ†æ**ï¼š
   - æŸ¥çœ‹ Network æ ‡ç­¾ä¸­çš„ Response
   - åˆ†ææ˜¯ HTMLã€JSON è¿˜æ˜¯å…¶ä»–

4. **å…¶ä»–æ‹¦æˆªç‚¹**ï¼š
   - æ£€æŸ¥ `next.config.mjs` ä¸­çš„ rewrites/redirects
   - æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰æœåŠ¡å™¨
   - æ£€æŸ¥æ˜¯å¦æœ‰åå‘ä»£ç†

---

**æµ‹è¯•è„šæœ¬ä½ç½®**ï¼š`./test-static-resource.sh`  
**ä¿®å¤æ–¹æ¡ˆä½ç½®**ï¼š`middleware.ts.NATIVE-COOKIE-CHECK.ts`

