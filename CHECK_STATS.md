# 检查全局指标问题

## 问题：创建了指标但前端还是没有变化

### 可能的原因

1. **指标名称不匹配**（最可能）
   - 脚本要求**精确匹配**，包括空格和大小写
   - 必须完全一致：
     - `进行中事件`（不是"进行中事件数"或"进行中的事件"）
     - `24H 交易量`（注意是"24H"不是"24h"或"24小时"）
     - `总锁仓量 (TVL)`（注意括号前后有空格）
     - `24H 活跃交易者`（注意是"24H"不是"24h"）

2. **指标状态不是"启用"**
   - 检查后台管理界面，确保所有指标的"状态"都是"启用"

3. **脚本还没有运行**
   - 创建指标后，需要运行脚本更新数值：
     ```bash
     npx tsx scripts/scrapers/calculate-global-stats.ts
     ```

4. **前端缓存**
   - 清除浏览器缓存或使用无痕模式
   - 前端组件每60秒自动刷新

### 检查步骤

1. **检查数据库中的指标名称**：
   ```sql
   SELECT id, label, value, isActive FROM global_stats;
   ```

2. **检查API返回的数据**：
   访问：`http://localhost:3000/api/stats`
   应该返回类似：
   ```json
   {
     "success": true,
     "data": [
       {
         "id": "...",
         "label": "进行中事件",
         "value": 500,
         "unit": null,
         "icon": "...",
         "sortOrder": 1,
         "isActive": true
       },
       ...
     ]
   }
   ```

3. **检查脚本日志**：
   运行脚本后，应该看到：
   ```
   ✅ [Global Stats Calc] 已更新 进行中事件: 500
   ✅ [Global Stats Calc] 已更新 24H 交易量: $94,773,631
   ...
   ```
   如果看到 `⚠️ 指标不存在`，说明名称不匹配。

### 快速修复

1. **检查指标名称**：
   - 进入后台管理 → 全局指标管理
   - 检查每个指标的"指标名称"是否完全匹配：
     - `进行中事件`
     - `24H 交易量`
     - `总锁仓量 (TVL)`
     - `24H 活跃交易者`

2. **如果名称不匹配，修改为正确名称**：
   - 点击"编辑"按钮
   - 修改"指标名称"为完全匹配的名称
   - 保存

3. **运行脚本更新数值**：
   ```bash
   npx tsx scripts/scrapers/calculate-global-stats.ts
   ```

4. **刷新前端页面**：
   - 清除浏览器缓存
   - 或使用无痕模式访问

### 正确的指标配置示例

| 指标名称 | 数值 | 单位 | 图标 | 排序 | 状态 |
|---------|------|------|------|------|------|
| 进行中事件 | 0 | (空) | Activity | 1 | 启用 |
| 24H 交易量 | 0 | $ | DollarSign | 2 | 启用 |
| 总锁仓量 (TVL) | 0 | $ | BarChart3 | 3 | 启用 |
| 24H 活跃交易者 | 0 | (空) | Users | 4 | 启用 |

**注意**：
- 指标名称必须**完全一致**，包括空格和大小写
- 数值初始值可以是0，脚本会自动更新
- 状态必须是"启用"

